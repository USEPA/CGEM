#
# Makefile to build the EPACOM GEM 3D model
#
# Note:
# - These settings are for the *INTEL* compiler.
# - Comment out the F90 and LIBS definitions to use the PGI compiler.
# - Ensure you load the appropriates modules before building (if applicable).

### =============== User Modifiable Section =============== ###

### Uncomment the next line to enable debugging
#DFLAGS = -warn -debug all -g -check all -ftrapuv #-DDEBUG -mcmodel=medium -shared-intel 

### Build options for specific platforms. (Shouldn't change much.)
SOL_INC	  = -I.
SOL_LIBS  = -L/usr/local/apps/netcdf-4.3.2/intel-15.0/lib/ \
            -L/usr/local/apps/hdf5-1.8.13/intel-15.0/lib \
            -lnetcdf -lnetcdff -lgfortran
IRIS_INC  = -I. -I/project/gulfbreeze/include
IRIS_LIBS = -L. -L/project/gulfbreeze/lib -lnetcdff -lnetcdf -lgfortran
# This is the list of objects to compile. Edit as necessary to reflect
# source file changes.

OBJ  =  Model_dim.o\
	EPA_GEM_Params.o\
	INPUT_VARS.o\
	Which_Flux.o\
	LIGHT_VARS.o\
	RKVectorMod.o\
	TEMP_VARS.o\
	OUTPUT_NETCDF.o\
	MOD_EPACOM_GEM_UTILITIES.o\
	Calc_Chla.o\
	calc_Agrow_ij.o\
        EPACOM_GEM.o\
        JY.o\
        mdatePminPsec.o\
	simple_sea_sfc_refract.o\
        GEM_EPA.o\
        getSolar.o\
        iFijn.o\
	mdate_julian.o\
	reaction.o\
	calc_solar_zenith.o\
	rnitrate.o\
	Output_Data_1D.o\
	Set_Initial_Conditions.o\
	Read_InputFile.o\
	Calc_RKVector.o\
        Call_IOP_PAR.o\
	func_T.o\
	func_E.o\
	func_S.o\
	Nitrification.o\
	func_Qs.o\
	Q10_T.o\
	USER_getLonLat.o\
	USER_get_basic_grid.o\
	USER_get_Vars.o\
	USER_get_masks.o\
	USER_Read_Solar.o\
	USER_close_file.o\
	USER_Set_Initial_Conditions.o\
	Close_Output_Data_1D_text.o\
	USER_output_data.o\
	Output_Data_Calibration_open.o\
	Output_Data_Calibration_close.o\
	Write_InputFile.o\
	DailyRad_init.o\
	Flux.o\
	USER_Read_Wind.o\
	gas_exchange.o\
	SchmidtNumber.o\
	o2sat.o\
	sw_dens0.o\
	sw_smow.o


### =============== End User Modifiable Section  =============== ####


### These lines should seldom change! ###
F90	= gfortran 
FFLAGS =  #-warn all -traceback -no-diag-error-limit -implicitnone -convert big_endian -ftz
#PFLAGS = -profile-functions -profile-loops=all
EXE	= EPACOM_GEM.exe
MY_HOST	  = $(shell hostname)
ifeq (iris,$(findstring iris,$(MY_HOST)))
  INC	   = $(IRIS_INC)
  LIBS	   = $(IRIS_LIBS)
else
  INC	   = $(SOL_INC)
  LIBS	   = $(SOL_LIBS)
endif

ocean: ${OBJ}
	$(F90) -o $(EXE) $(FFLAGS) $(DFLAGS) $(PFLAGS) $(OBJ) $(LIBS)

#
# Pattern rules
#

# These items must have compiler optimization disabled
$(NO_OPT_OBJS): %.o: %.F90
	$(F90) -c -O0 $(FFLAGS) $(INC) $(DFLAGS) $(PFLAGS) $<

# Generic implicit rules
%.o: %.F90 
	$(F90) -c $(FFLAGS) $(DFLAGS) $(PFLAGS) $<	

#
# Miscellaneous targets
#

clean:
	rm -f *.o ${EXE} *.mod *genmod*

realclean: clean
	rm -f #*# *~ TAGS

tags:
	ctags --language-force=Fortran *.F90

etags:
	etags -l fortran *.F90
